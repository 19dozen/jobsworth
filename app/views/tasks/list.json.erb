{
    "tasks": {
        "rows": [
<%      total_time = 0
        @tasks.each_with_index do |task, idx|
        cache([ task, current_user.id ]) do
        customer = (task.customers.first || task.project.customer) -%>
            {
<%      readFlag = ""
        total_time += task.minutes_left.to_i
        if (task.unread?(current_user))
                readFlag = "f" # this task is unread
        else if (task.users + task.watchers).include?(current_user) # only users assigned to or watching a task can mark unread
                readFlag = "t" # this task is read and can be switched to unread
                else
                readFlag = "x" # this task doesn't have the current user assigned/cc
                end
        end
-%>
                "read": "<%= readFlag %>",
                "id": "<%= task.task_num %>",
                <% current_user.company.properties.each do |prop| -%>
                <% pv = task.property_value(prop) -%>
                "<%= prop.name.downcase %>": "<%= pv.to_html.gsub('"', "'") if pv %>",
                <% end -%>
                "summary": "<%=h task.name %>",
                "client": "<%=h customer.name %>",
                <% str = [ task.project.name ] -%>
                <% str << task.milestone.name if task.milestone_id.to_i > 0 -%>
                "milestone": "<%= str.join("/") %>",
                "due": "<%= task.due_date.to_time.to_i unless task.due_date.nil? %>",
                "time": "<%= task.minutes_left.to_i %>",
                "assigned": "<%= task.owners.map{ |u| u.name }.join(", ") %>",
                "resolution": "<%= task.status_type %>"
            }<%= "," unless @tasks.size - 1 == idx  %>
        <% end -%>
        <% end -%>
        ],
        "userdata": <%= total_time %>
    }
}